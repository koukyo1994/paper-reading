# Interaction Networks for Learning about Objects, Relations and Physics

## Basic Information

| 引用情報 |                                                                                                             |
| -------- | ----------------------------------------------------------------------------------------------------------- |
| 筆者     | Peter W. Battaglia, Razvan Pascanu, Matthew Lai, Danilo Rezende, Koray Kavukcuoglu                          |
| 所属     | Google DeepMind                                                                                             |
| 会議     | NIPS                                                                                                        |
| 年       | 2016                                                                                                        |
| 引用数   | 405                                                                                                         |
| リンク   | https://papers.nips.cc/paper/6418-interaction-networks-for-learning-about-objects-relations-and-physics.pdf |

## どんなもの

物体どうしの相互作用や抽象的な性質の推論が可能な*Interaction Network*の提案。DNNを使って入力されたグラフから物体やそれらの関係を推論する。n体問題や剛体の衝突などの物理系でのシミュレーションやエネルギーなどの抽象的な量の算出などを行える、learnableな物理エンジンである。

Interaction Networksは

1. 構造化モデリング
2. シミュレーション
3. Deep Learning

の三つを組み合わせている。構造化モデリングは物体間の明示的な関係を利用することができ、物体間の推論などについても様々な利用方法がありうる。シミュレーションは動的なシステムを抽象化して個々の要素が複雑な相互作用の中でどのような挙動をするかを予測することができる。Deep Learningは非常に柔軟でスケーラブルな学習と推論の枠組みを提供する。

Interaction Networksでは、relationに関する推論とobjectsに関する推論は明示的に分ける。これにより、物体の数やrelationの数に制約なくその組み合わせの数だけ対応できるようになっている。また、relationを明示的な入力として受けることにより全ての物体間の関係を考える必要をなくしている。

## 先行研究に比べてどこがすごい

グラフに関してニューラルネットワークによって推論を行う、Graph-Neural-Networkに影響を受けている。Graph-Neural-Networkとはノードとエッジからなる枠組みに対応できるNNである。

一方Interaction Networkの挙動自体は物理シミュレーションエンジンに似ている。すなわち、物理的な物体間の相互作用とダイナミクスを近似したルールを適用することで状態列を生成する点についてである。

物理的な系における推論でのこれまでのAI研究では、物理的な予測や推論に常識的な知識や、シミュレーションの技術、qualitative representations(よく分からん)を用いていた。

## 技術や手法のキモはどこ

object-centricな作用(一つのobjectに働く作用)と、relation-centricな作用(複数の物体の間に働く作用)を分けて考える。

object-centricな作用の計算には関数$`f_O`$を用いる。これはobjectの時刻$`t`$における状態$`o_t`$を受け取り、次の時刻の状態$`o_{t+1}`$を出力する。複数のobjectsが同じ規則に従っている場合、$`f_O`$はそのそれぞれに対して適用される。

objectsどうしのinteractionがある場合には、$`f_O`$の挙動は変化する。この場合まず、$`f_R`$がrelation-centricな作用を計算する。その上でその出力も$`f_O`$は引数として受け取る

```{latex}
e_{t+1} = f_R(o_{1, t}, o_{2, t}, r), o_{2, t+1} = f_O(o_{2, t}, e_{t+1})
```

関係$`r`$は例えばバネ定数のような関係にまつわる属性である。

これらの定式化はグラフ$`G=<O, R>`$を用いることでより複雑なシステムに対して拡張される。この時問題設定として、attributed, directed multigraphを考える。これは物理系の関係はバネ定数のような属性をもったり、複数の関係が同時に働く(例えば剛体の相互作用と磁気的な相互作用は同時に起こりうる)ことがあるからである。

$`N_O`$個のobjectsと$`N_R`$個のrelationsが存在するシステムにおいてはInteraction Networks(IN)の入力は

```{latex}
O = \{o_j\}_{j=1\cdots N_O}, R = \{<i, j, r_k>_k\}_{k=1\cdots N_R}~where i\neq j, 1\le i,j\le N_O, X=\{x_j\}_{j=1\cdots N_O}
```

と表される。$`X`$は各objectsに外部から入力される効果である。INは

![interaction-networks](figures/interaction-networks-formulation.png)

と表現される。$`b_k`$はrelationのtripletであり$`B`$はその集合である。$`\phi_R`$は$`f_R`$を$`b_k`$に適用することで$`e_k\in E`$、すなわち相互作用効果を予測するネットワークである。$`a`$は集約関数であり、全ての相互作用効果を集めてreciever objectに適用し、$`O`$と$`X`$をまとめ上げてobjectsモデルの入力$`c_j\in C`$を構成する。objectモデル$`\phi_O`$は相互作用と物体内でのダイナミクスがどう物体の状態に影響するかを$`f_O`$を$`c_j`$それぞれに対して適用して$`p_j\in P`$を返すことで予測する。物理系であれば$`P=O_{t+1}`$である。
しかし、$`p_j\in P`$をさらに別の集約関数$`g`$と組み合わせて抽象化モデル$`\phi_A`$などに入力して単一の出力$`q`$を返すようにすればpotential energyの予測などにも使える。

### 実装

![diagram](figures/Interaction-Networks-Diagram.png)

前の定式化において関数系などには制約はなかったが、実装においては関数表現としてMLPを用いた。$`O`$を$`D_S\times N_O`$の行列とし各列が物体の$`D_S`$の長さの状態ベクトルとした。関係のtriplet$`R=<R_r, R_s, R_a>`$について、$`R_r`$と$`R_s`$は$`N_O\times N_R`$の二値行列として表現し、$`R_a`$は$`D_R\times N_R`$の行列とした。ここで$`D_R`$の長さの列がそれぞれの関係の属性を表現している。例えば

![overview](figures/interaction-networks-overview.png)

のbにおいては

```{latex}
R_r = \left[
    \begin{matrix}
        0 & 0 \\
        1 & 1 \\
        0 & 0
    \end{matrix}
\right] \\

R_s = \left[
    \begin{matrix}
        1 & 0 \\
        0 & 0 \\
        0 & 1
    \end{matrix}
\right]
```

となる。$`X`$は$`D_X\times N_O`$の行列であり、各列がそれぞれのobjectに適用される外部効果を表現した$`D_X`$次元のベクトルである。relationのtripletをまとめる関数は単純にconcatenation$`m(G) = [OR_r;OR_s;R_a]`$を行うだけとする。

$`f_R`$はMLPであるとし、その出力は相互作用効果を表現した$`D_E`$次元のベクトルであるとする。$`\phi_R`$はその効果をまとめ上げて$`D_E\times N_R`$の効果行列にする。

集約関数$`a`$の入力は$`G, X, E`$でありその出力は$`a(G, X, E)=[O; X; \bar{E}]=C`$である。この$`\bar{E}`$は各reciever objectにおける各relationの和をまとめた関数であり、$`\bar{E}=ER_r^T`$と表される$`D_E\times N_O`$の行列である。

この$`C`$は$`(D_S+D_X + D_E)\times N_O`$の行列であり、これが関数$`\phi_O`$の入力となる。$`\phi_O`$は$`f_O`$(MLP)を$`N_O`$個のそれぞれの列に対して適用し、$`D_P`$の長さのベクトル$`p_j`$をまとめて$`P`$とする。

エネルギーなどの抽象的な量を推定したい場合はさらに$`\phi_A`$を$`P`$に適用する。集約関数$`g`$が$`P`$の列ごとの和をとり、$`D_P`$の長さのベクトル$`\bar{P}`$をMLPへの入力とする。MLP$`\phi_A`$はこれを処理して$`D_A`$の長さのベクトル$`q`$を出力しこれが抽象的な量となる。

INの学習には$`\phi_R`$と$`\phi_O`$の学習のための目的関数が必要となる。CNNと同じく$`\phi_R`$と$`\phi_O`$は全てのobject / relationに関して同じなので効率が良い。

**CNNは近傍のピクセルが相互に関連し合うとして扱い、それぞれのピクセルがrecieverかつsenderであるとする。畳み込み演算は$`\phi_R`$に相当し、residual connectionは$`O`$がどのようにして$`\phi_R`$や$`\phi_O`$に入力されるかを表しているためある種INに似ている。**

## どうやって有効だと検証した

物理系の将来の状態の予測と、potential energyの予測を、

1. 多体問題
2. 箱の中でのボールの挙動
3. バネ紐と剛体の衝突

の三つの設定で行った。これらの実験は物理エンジンを使って2Dの軌道を作成した。

![examples](figures/in-training-examples.png)

### 多体問題

n個の物体があるとした場合、その間には重力が働くとしてn(n-1)の関係を入力とした。物体の質量だけは異なるものとした。安定軌道のある速度を持つものとそうでないものを半々とした。

### ボールの衝突

壁は長方形の形の物体とし、逆質量が0になるようにした。物体の関係は壁を入れたn物体の間のn(n-1)個あるとした。衝突という関係は実際に発生するのが稀なため重力よりも難しい設定である。

### 紐

紐に関しては二つの関係を考えた。紐はn個の物体の間でバネの関係になっているとし、そこに重力が働いているとした。また、その紐の下に丸い物体がありその物体との作用も考えた。重力はXとして与えた。

### データ

1000 time stepに渡ってシミュレーションされた2000個のシーンからtraining / validation / testを作った上で100万ステップ / 200kステップ / 200kステップ分のinput-targetのペアをサンプリングした。
学習の際にガウスノイズを入力の位置と速度に加える、などもした。これは結果のerror measureには影響を与えなかったが、ノイズ有りの方が少し見た目的にそれっぽかった。

### 実験と結果

比較対象として入力をそのまま出力にするようなもの、MLP、そしてINの変種を使った。
パッと見、比較実験はそんなにやっていない印象。

物体の数を変えても汎化することを確認。ある設定で学習したbestモデルを別の設定でテストしてもちゃんと予測できることを確認。より物体数が少ないシステムでテストすると、それより少ない物体数で学習したモデルよりパフォーマンスが良かった。

1ステップで学習したモデルが数千ステップの間軌道を予測できることも見つけた。(特に多体問題と紐)。ポテンシャルエナジーの予測も正確にできた。

## 議論はある

物理系でとても良く学習できており、汎化性能もある。ポテンシャルエナジーのような量も学習できる。

将来的には多数の相互作用がからむ巨大なシステムで検証したい。
モデル予測制御で使えるかも。外的要因Xとして制御入力をいれる。differentiableなので勾配ベースのプランニングができる。

RNNにINを適用したらより長い依存関係の把握もできるかも。

INを生成モデルにしたら、未知の物体の性質や属性の予測に使えるかも。

複雑な系をobjectとrelationに分解し、明示的にそれらについて推論することで人と機械の間を埋めることができるかもしれない。

## 次に読むべき論文は

Chang, Michael B., et al. "A compositional object-based approach to learning physical dynamics." arXiv preprint arXiv:1612.00341 (2016).とか？
